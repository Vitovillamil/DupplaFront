<div	class	= "box">
	<section>
		<div	class	= "d-flex justify-content-between align-items-center mb-3">
			<h1>Documentos</h1>

			<a	routerLink	= "nuevo"	class	= "btn btn-primary"	ngbTooltip	= "Procesa los documentos seleccionados">
				+ Nuevo documento
			</a>
		</div>
	</section>

	<section	class	= "box-content">
		<form
			[formGroup]	= "filterForm"
			(ngSubmit)	= "applyFilters()"
			class		= "row g-2"
		>
			<section	class	= "col-md">
				<section	class	= "row g-2">
					<section	class	= "col-md-4">
						<label>Tipo</label>
						<input
							type			= "text"
							class			= "form-control"
							placeholder		= "Tipo"
							formControlName	= "tipo"
						>
					</section>

					<section	class	= "col-md-4">
						<label>Estado</label>
						<select	class	= "form-select"	formControlName	= "estado">
							<option value	= "">-- Selecione estado --</option>
							<option *ngFor	= "let e of ['borrador','pendiente','aprobado','rechazado']">
								{{ e }}
							</option>
						</select>
					</section>

					<section	class	= "col-md-4">
						<label>Monto Minimo</label>
						<input
							type			= "number"
							class			= "form-control"
							placeholder		= "Monto mínimo"
							formControlName	= "monto_min"
						>
					</section>

					<section	class	= "col-md-4">
						<label>Monto Máximo</label>
						<input
							type			= "number"
							class			= "form-control"
							placeholder		= "Monto máximo"
							formControlName	= "monto_max"
						>
					</section>

					<section	class	= "col-md-4">
						<label>Fecha desde</label>
						<input
							class			= "form-control"
							ngbDatepicker
							#dDesde			= "ngbDatepicker"
							formControlName	= "fecha_desde"
							(click)			= "dDesde.toggle()"
						>

					</section>

					<section	class	= "col-md-4">
						<label>Fecha hasta</label>
						<input
							class			= "form-control"
							ngbDatepicker
							#dHasta			= "ngbDatepicker"
							formControlName	= "fecha_hasta"
							(click)			= "dHasta.toggle()"
						>
					</section>
				</section>
			</section>

			<div	class	= "col-md-auto">
				<button	class	= "btn btn-primary w-100"	style	= "margin-top: 23px; padding:2vh 7vh; height: 110px;"	ngbTooltip	= "Se Filtrará con los datos que agregaste">
					Filtrar
				</button>
			</div>
		</form>

		<section	style	= "margin-top:2vh; padding-top:2vh; border-top:1px solid #ababab">
			<section	class	= "text-center my-4"	*ngIf	= "loading">
				<div	class	= "spinner-border text-primary"	role	= "status"></div>
			</section>

			<section	*ngIf	= "!loading && documents.length == 0"	class	= "alert alert-warning text-center">
				No hay documentos
			</section>

			<section	*ngIf	= "!loading && documents.length > 0">
				<table	class	= "table table-striped-columns table-hover">
					<thead	class	= "table-dark">
						<tr>
							<th></th>
							<th>Estado</th>
							<!--<th>ID</th>-->
							<th>Tipo</th>
							<th>Monto</th>
							<th>Fecha</th>
							<th>Acción</th>
						</tr>
					</thead>

					<tbody>
						<tr	*ngFor	= "let doc of documents">
							<td>
								<input
									type		= "checkbox"
									[checked]	= "selected.has(doc.id)"
									(change)	= "toggle(doc.id)"
									*ngIf		= "doc.id && doc.estado == 'pendiente'"
								>
							</td>
							<td>
								<p
									class		= "badge w-100"
									[ngClass]	= "statusClass(doc.estado)"
									style		= "margin:0;"
								>
									{{ doc.estado }}
								</p>
							</td>
							<!--<td>{{ doc.id }}</td>-->
							<td>{{ doc.tipo }}</td>
							<td>{{ doc.monto | currency }}</td>
							<td>{{ doc.fecha_creacion | date:'dd/MM/yyyy HH:mm:ss' }}</td>
							<td>
								<a
									class			= "btn btn-warning w-100"
									[routerLink]	= "[doc.id]"
									style			= "--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
									*ngIf			= "doc.estado == 'pendiente' || doc.estado == 'borrador'"
								>
									Editar
								</a>
							</td>
						</tr>
					</tbody>
				</table>

				<ngb-pagination
					[collectionSize]	= "total"
					[(page)]			= "page"
					[pageSize]			= "size"
					(pageChange)		= "load()"
					class				= "d-flex justify-content-center"
				>
				</ngb-pagination>

				<div	*ngIf	= "selected.size > 0"	style	= "margin-top:2vh; padding-top:2vh; border-top:1px solid #ababab"></div>

				<button
					class		= "btn btn-outline-primary"
					[disabled]	= "processing || selected.size === 0"
					(click)		= "processBatch()"
					*ngIf		= "selected.size > 0"
					ngbTooltip	= "Procesa los documentos seleccionados"
				>
					Procesar seleccionados ({{ selected.size }})
				</button>

				<ngb-alert
					*ngIf			= "job"
					[type]			= "job.status === 'completado' ? 'success' : 'info'"
					[dismissible]	= "false"
					class			= "mt-3"
				>
					<h6>
						Job #{{ job.id }}
						<span	*ngIf	= "job.status != 'completado'">Procesando documentos…</span>
					</h6>

					<span	*ngIf	= "job.status != 'completado'">Procesando: {{job.processed}}	de {{job.total}}</span>

					<div
						class			= "progress"
						role			= "progressbar"
						aria-valuenow	= "25"
						aria-valuemin	= "0"
						aria-valuemax	= "100"
					>
						<div
							class	= "progress-bar"
							[style.width.%]	= "(job.progress)"
						>
							{{job.progress}} %
						</div>
					</div>

					<p>Estado: {{ job.status }} <span	*ngIf	= "job.status == 'completado'">| {{job.total}} documento(s) procesado(s)</span></p>
				</ngb-alert>
			</section>
		</section>
	</section>
</div>
